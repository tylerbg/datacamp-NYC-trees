---
title: "Untitled"
author: "tylerbg"
date: "2022-12-20"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libs}
libs <- c('tidyverse', 'tidymodels')

sapply(libs, library, character.only = TRUE)
```


## Analysis Questions and Goals:

- What are the most common tree species in Manhattan?
- Which are the neighborhoods with the most trees?
- A visualization of Manhattan's neighborhoods and tree locations.
- What ten tree species would you recommend the city plant in the future?


### Variables

- *tree_id* - Unique identification number for each tree point.
- *tree_dbh* - Diameter of the tree, measured at approximately 54" / 137cm above the ground. Data was collected for both living and dead trees; for stumps, use stump_diam
- *curb_loc* - Location of tree bed in relationship to the curb; trees are either along the curb (OnCurb) or offset from the curb (OffsetFromCurb)
- *spc_common* - Common name for species, e.g. "red maple".
- *status* - Indicates whether the tree is alive, standing dead, or a stump.
- *health* - Indicates the user's perception of tree health.
- *root_stone* - Indicates the presence of a root problem caused by paving stones in tree bed.
- *root_grate* - Indicates the presence of a root problem caused by metal grates in tree bed.
- *truck_wire* - Indicates the presence of a trunk problem caused by wires or rope wrapped around the trunk.
- *trnk_light* - Indicates the presence of a trunk problem caused by lighting installed on the tree.
- *trnk_other* - Indicates the presence of other trunk problems.
- *brch_light* - Indicates the presence of a branch problem caused by lights (usually string lights) or wires in the branches.
- *brch_shoe* - Indicates the presence of a branch problem caused by sneakers in the branches.
- *brch_other* - Indicates the presence of other branch problems.
- *postcode* - Five-digit zipcode in which tree is located.
- *nta* - This is the NTA Code corresponding to the neighborhood tabulation area from the 2010 US Census that the tree point falls into.
- *nta_name* - This is the NTA name corresponding to the neighborhood tabulation area from the 2010 US Census that the tree point falls into.
- *latitude* - Latitude of point, in decimal degrees
- *longitude* - Longitude of point, in decimal degrees

## EDA

```{r load-data}
trees <- read_csv('data/raw/trees.csv')
```


```{r data-info}
dim(trees)
str(trees)
summary(trees)
```
There are no apparent missing values.

For the `character` variables, we will determine how many unique values are in each variable to assess whether we want to keep them as `character` or convert them to the `factor` type.

```{r unique-chars}
trees %>%
  select(where(is_character)) %>%
  apply(2, function(x) length(unique(x)))
```

The number of unique values for each of the `character` columns ranges between 2 and 129, with most variables at or near 2.  Since we have a large amount of observations (over 60,000), we can assign each as factors.  We will then print new summary statistics for the data set.

```{r char-to-factor}
trees <- trees %>%
  mutate(across(where(is_character), factor))

summary(trees)
```

In the output, there are now obvious missing values, specifically in the *spc_common* and *health* columns.  The total number of missing values in both variables is about the same, so we will check how many observations are missing values for both variables.  Also to note, the number of missing values also matches the 'Dead' value for the *status* variable, for which we will also check how many missing values belong.

```{r obs-na}
sum(is.na(trees$spc_common) & is.na(trees$health))

sum(is.na(trees$health) & trees$status == 'Dead')
```

All observations except one with missing values in the *health* variable shares a missing value in the *spc_common* variable.  Additionally, all of the missing values in the *health* variable come from observations where *health* has a value of 'Dead'.  Therefore, instead of dropping missing values we will recode the missing values in *spc_common* as 'Unknown' and those in *health* as 'Dead'.

```{r na-recode}
trees <- trees %>%
  mutate(spc_common = fct_explicit_na(spc_common, 'Unknown'),
         health = fct_explicit_na(health, 'Dead'))
```



## What are the most common tree species in Manhattan?




## A visualization of Manhattan's neighborhoods and tree locations.

The spatial data set provided in the Data Camp assignment does not load properly in R, either locally or in the Data Camp workspace.  Therefore, we will load the raw data directly from NYC Open Data, then filter the spatial data set for only the manhattan area.


```{r}
neighborhoods <- st_read('data/raw/direct_NYC/geo_export_be6f9d73-0dae-46ea-bbed-99ae04ed44e2.shp', quiet=TRUE)

manhattan <- neighborhoods %>%
  filter(boroname == 'Manhattan')
```

Then, we will plot the tree locations with the NTA neighborhood borders using a distinct color for the trees that reside in each neighborhood.

```{r}
library(pals)

ggplot(manhattan) + 
  geom_point(data = trees,
             aes(longitude, latitude, color = nta),
             size = 0.1, alpha = 0.05, show.legend = FALSE) +
  geom_sf(fill = NA) +
  scale_color_manual(values = as.vector(polychrome())) +
  theme_classic()
```

